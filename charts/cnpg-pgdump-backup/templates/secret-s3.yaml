{{- if and .Values.s3.secretName (not .Values.s3.useExistingSecret) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.s3.secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "cnpg-backup.labels" . | nindent 4 }}
  annotations:
    description: "S3 backup credentials for CNPG backup chart"
type: Opaque
stringData:
  AWS_ACCESS_KEY_ID: {{ required "AWS access key ID is required when creating secret" .Values.s3.awsAccessKeyId }}
  AWS_SECRET_ACCESS_KEY: {{ required "AWS secret access key is required when creating secret" .Values.s3.awsSecretAccessKey }}
{{- else if .Values.s3.useExistingSecret }}
---
# This file documents the expected secret structure when using existing secrets
# No resources are created - you must ensure the secret exists before deployment
#
# Example Secret structure:
# apiVersion: v1
# kind: Secret
# metadata:
#   name: {{ .Values.s3.secretName }}
# type: Opaque
# data:
#   AWS_ACCESS_KEY_ID: <base64-encoded-key>
#   AWS_SECRET_ACCESS_KEY: <base64-encoded-secret>
{{- end }}