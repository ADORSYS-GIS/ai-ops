## @section Global Configuration
## @param fullnameOverride Full name override
## @param nameOverride Name override

## @section Backup Configuration
## @param backup.enabled Enable scheduled backups
## @param backup.schedule Cron schedule for backup jobs (default: daily at 2 AM)
## @param backup.image PostgreSQL image for backup/restore jobs
## @param backup.imagePullPolicy Image pull policy
## @param backup.retentionDays Number of days to retain backups in S3 (0 = no auto-retention)
## @param backup.resources Resources for backup/restore pods
## @param backup.nodeSelector Node selector for backup pods
## @param backup.tolerations Tolerations for backup pods
## @param backup.affinity Affinity rules for backup pods

## @section CNPG Cluster Configuration
## @param cnpg.secretName Secret name containing CNPG connection details (host, port, username, password)
## @param cnpg.database Database name to backup
## @param cnpg.serviceName CNPG cluster service name (for service discovery)

## @section S3 Storage Configuration
## @param s3.bucket S3 bucket name
## @param s3.prefix S3 prefix/path within bucket
## @param s3.region AWS region
## @param s3.endpoint S3 endpoint URL (optional, for MinIO or other S3-compatible storage)
## @param s3.secretName Secret name containing AWS credentials (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY)
## @param s3.secretTemplate Use existing secret instead of managed secret
## @param s3.storageClass S3 storage class (optional)

## @section Restore Configuration
## @param restore.enabled Enable restore functionality
## @param restore.object S3 object key to restore (empty = manual trigger required)
## @param restore.backupBeforeRestore Create a backup before restoring (for safety)
## @param restore.force Ignore warnings and proceed with restore
## @param restore.resources Resources for restore pod

## @section Security Context
## @param securityContext.runAsNonRoot Run containers as non-root user
## @param securityContext.runAsUser User ID to run containers
## @param securityContext.runAsGroup Group ID to run containers
## @param securityContext.readOnlyRootFilesystem Use read-only root filesystem
## @param securityContext.allowPrivilegeEscalation Allow privilege escalation

## @section Monitoring
## @param monitoring.annotations Pod annotations for monitoring

## @section Image Pull Secrets
## @param imagePullSecrets Image pull secrets list

global:
  # -- Full name override
  fullnameOverride: ""
  # -- Name override
  nameOverride: ""

backup:
  # -- Enable scheduled backups
  enabled: true
  # -- Cron schedule (default: daily at 2 AM)
  schedule: "0 2 * * *"
  # -- PostgreSQL image for backup/restore jobs
  image: postgres:16
  # -- Image pull policy
  imagePullPolicy: IfNotPresent
  # -- Number of days to retain backups in S3 (0 = no auto-retention, use S3 lifecycle rules)
  retentionDays: 0
  # -- Number of successful jobs to keep
  successfulJobsHistoryLimit: 3
  # -- Number of failed jobs to keep
  failedJobsHistoryLimit: 3
  # -- Concurrency policy (Forbid, Replace, Allow)
  concurrencyPolicy: Forbid
  # -- TTL seconds after job finishes
  ttlSecondsAfterFinished: null
  # -- Termination grace period seconds
  terminationGracePeriodSeconds: 30
  # -- Resources for backup/restore pods
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "1000m"
      memory: "1Gi"
  # -- Node selector for backup pods
  nodeSelector: {}
  # -- Tolerations for backup pods
  tolerations: []
  # -- Affinity rules for backup pods
  affinity: {}
  # -- Liveness probe configuration
  livenessProbe: null

cnpg:
  # -- Secret name containing CNPG connection details (must contain: host, port, username, password)
  secretName: ""
  # -- Database name to backup
  database: ""
  # -- CNPG cluster service name (for service discovery)
  serviceName: ""

s3:
  # -- S3 bucket name
  bucket: ""
  # -- S3 prefix/path within bucket
  prefix: ""
  # -- AWS region
  region: us-east-1
  # -- S3 endpoint URL (optional, for MinIO or other S3-compatible storage)
  endpoint: ""
  # -- Secret name containing AWS credentials (must contain: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY)
  secretName: ""
  # -- Use existing secret instead of managed secret (set secretName and use this = true)
  useExistingSecret: false
  # -- S3 storage class (optional)
  storageClass: ""
  # -- AWS Access Key ID (required when creating secret)
  awsAccessKeyId: ""
  # -- AWS Secret Access Key (required when creating secret)
  awsSecretAccessKey: ""
# Validation can be added in _helpers.tpl or using required() in templates
# For simplicity, using required() in templates as shown above

restore:
  # -- Enable restore functionality
  enabled: true
  # -- S3 object key to restore (empty = manual trigger required via --set)
  object: ""
  # -- Create a backup before restoring (for safety)
  backupBeforeRestore: false
  # -- Ignore warnings and proceed with restore
  force: false
  # -- PostgreSQL image for restore job
  image: null
  # -- Image pull policy
  imagePullPolicy: null
  # -- TTL seconds after job finishes
  ttlSecondsAfterFinished: 300
  # -- Backoff limit for job retries
  backoffLimit: 4
  # -- Termination grace period seconds
  terminationGracePeriodSeconds: 30
  # -- Resources for restore pod
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "1000m"
      memory: "2Gi"
  # -- Node selector for restore pod
  nodeSelector: {}
  # -- Tolerations for restore pod
  tolerations: []
  # -- Affinity rules for restore pod
  affinity: {}

securityContext:
  # -- Run containers as non-root user
  runAsNonRoot: true
  # -- User ID to run containers
  runAsUser: 999
  # -- Group ID to run containers
  runAsGroup: 999
  # -- Use read-only root filesystem
  readOnlyRootFilesystem: true
  # -- Allow privilege escalation
  allowPrivilegeEscalation: false

monitoring:
  # -- Pod annotations for monitoring
  annotations: {}

# -- Image pull secrets
imagePullSecrets: []

